# PLC选择指令测试程序

## 测试人员信息
- **测试人员**: 汪勇强
- **联系方式**: 13971612060  
- **QQ号码**: 94114148
- **测试日期**: 2025-08-30

## 概述

本程序专门测试PLC中的选择指令，包括范围限制、最大值最小值选择、多路选择等操作，用于实现数据选择和条件处理功能。

## 测试的指令

1. **LIMIT** - 限制在范围内
   - 将输入值限制在指定的最小值和最大值之间

2. **MAX** - 取最大值
   - 返回两个或多个输入值中的较大者

3. **MIN** - 取最小值
   - 返回两个或多个输入值中的较小者

4. **MUX** - 多路选择器
   - 根据选择索引从多个输入值中选择一个

5. **SEL** - 二路选择器
   - 根据布尔选择器选择两个输入值之一

## 测试数据类型

每个指令都测试两种数据类型：
- **INT** (整数)
- **REAL** (实数)

## 测试数据设计

### 整数测试数据
```
IntA := 10;        (* 主要测试值 *)
IntB := 5;         (* 较小测试值 *)
IntC := 15;        (* 较大测试值 *)
IntMin := 3;       (* 范围最小值 *)
IntMax := 12;      (* 范围最大值 *)

IntArray[0] := 100;  (* MUX测试用数组 *)
IntArray[1] := 200;
IntArray[2] := 300;
IntArray[3] := 400;
```

### 实数测试数据
```
RealA := 10.5;     (* 主要测试值 *)
RealB := 5.2;      (* 较小测试值 *)
RealC := 15.8;     (* 较大测试值 *)
RealMin := 3.1;    (* 范围最小值 *)
RealMax := 12.9;   (* 范围最大值 *)

RealArray[0] := 10.1;  (* MUX测试用数组 *)
RealArray[1] := 20.2;
RealArray[2] := 30.3;
RealArray[3] := 40.4;
```

### 选择器
```
BoolSelector := TRUE;   (* SEL指令的布尔选择器 *)
IntSelector := 2;       (* MUX指令的整数选择器 *)
```

## 详细测试用例

### 1. LIMIT测试 - 限制在范围内
```
整数: LIMIT(3, 15, 12) = 12 (15超出上限，返回12)
实数: LIMIT(3.1, 15.8, 12.9) = 12.9 (15.8超出上限，返回12.9)
```

### 2. MAX测试 - 取最大值
```
两个值:
整数: MAX(10, 5) = 10
实数: MAX(10.5, 5.2) = 10.5

三个值:
整数: MAX(MAX(10, 5), 15) = 15
实数: MAX(MAX(10.5, 5.2), 15.8) = 15.8
```

### 3. MIN测试 - 取最小值
```
两个值:
整数: MIN(10, 5) = 5
实数: MIN(10.5, 5.2) = 5.2

三个值:
整数: MIN(MIN(10, 5), 15) = 5
实数: MIN(MIN(10.5, 5.2), 15.8) = 5.2
```

### 4. MUX测试 - 多路选择器
```
整数: MUX(2, [100, 200, 300, 400]) = 300 (选择索引2的值)
实数: MUX(2, [10.1, 20.2, 30.3, 40.4]) = 30.3 (选择索引2的值)
```

### 5. SEL测试 - 二路选择器
```
整数: SEL(TRUE, 5, 10) = 10 (选择器为TRUE，选择第二个值)
实数: SEL(TRUE, 5.2, 10.5) = 10.5 (选择器为TRUE，选择第二个值)
```

## 🔧 独立结果变量设计

严格遵循PLC开发规范，每个指令都使用独立的结果变量：

### LIMIT结果变量
```
LIMITIntResult : INT;           (* LIMIT整数测试结果 *)
LIMITRealResult : REAL;         (* LIMIT实数测试结果 *)
```

### MAX结果变量
```
MAXIntResult : INT;             (* 两个值MAX整数测试结果 *)
MAXRealResult : REAL;           (* 两个值MAX实数测试结果 *)
MAX3IntResult : INT;            (* 三个值MAX整数测试结果 *)
MAX3RealResult : REAL;          (* 三个值MAX实数测试结果 *)
```

### MIN结果变量
```
MINIntResult : INT;             (* 两个值MIN整数测试结果 *)
MINRealResult : REAL;           (* 两个值MIN实数测试结果 *)
MIN3IntResult : INT;            (* 三个值MIN整数测试结果 *)
MIN3RealResult : REAL;          (* 三个值MIN实数测试结果 *)
```

### MUX结果变量
```
MUXIntResult : INT;             (* MUX整数测试结果 *)
MUXRealResult : REAL;           (* MUX实数测试结果 *)
```

### SEL结果变量
```
SELIntResult : INT;             (* SEL整数测试结果 *)
SELRealResult : REAL;           (* SEL实数测试结果 *)
```

## MUX指令兼容性说明

由于某些PLC环境可能不支持标准MUX函数，在本测试中使用条件选择语句替代：
```pascal
IF IntSelector = 0 THEN
    MUXIntResult := IntArray[0];
ELSIF IntSelector = 1 THEN
    MUXIntResult := IntArray[1];
ELSIF IntSelector = 2 THEN
    MUXIntResult := IntArray[2];
ELSE
    MUXIntResult := IntArray[3];
END_IF;
```

## 测试结果

程序执行后：
- **TestStep = 99**: 所有14个选择指令测试通过 ✅
- **TestStep = 88**: 有测试失败 ❌
- **Errors**: 显示失败的测试数量
- **TestsPassed**: 总体测试结果

## 关键特点

1. **全面覆盖**: 5个选择指令 × 多种数据类型 = 14个测试用例
2. **精确验证**: 使用精确的数值和边界条件测试
3. **独立隔离**: 每个测试使用独立变量，避免结果覆盖
4. **标准兼容**: 使用标准IEC 61131-3函数，确保Beremiz兼容性
5. **兼容处理**: 对于不支持的MUX指令，提供替代实现方案

## Beremiz兼容性

- ✅ **标准函数**: 主要使用标准IEC 61131-3函数
- ✅ **数据类型**: 使用标准的INT、REAL、BOOL类型
- ✅ **语法规范**: 遵循Beremiz的ST语法要求
- ⚠️ **MUX兼容**: 对于可能不支持的MUX函数，提供条件语句替代方案

## 应用场景

- **过程控制**: 参数范围限制和保护
- **数据选择**: 根据条件选择不同的数据源
- **优先级处理**: 选择最大或最小优先级值
- **多路数据处理**: 从多个数据源中选择一路处理

## 使用方法

1. 设置 `Enable = TRUE` 启动测试
2. 程序会依次执行所有选择指令测试
3. 观察各个结果变量查看具体的选择结果
4. 通过 `TestStep` 和 `Errors` 监控测试进度和结果
5. `Complete = TRUE` 表示测试执行完毕

## 文件说明

- **selection_instructions_test.st**: 独立的结构化文本文件
- **本文档**: 测试说明和选择指令详解

这个测试程序确保了PLC选择指令的正确性，覆盖了工业控制中最常用的数据选择和条件处理场景。